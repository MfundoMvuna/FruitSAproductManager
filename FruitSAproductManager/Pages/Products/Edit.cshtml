@page
@model FruitSAproductManager.Pages.Products.EditModel

<div class="container">
    <h1>Edit Product</h1>

    <form method="post" enctype="multipart/form-data">
        <div class="form-row">
            <div class="form-group col-md-6">
                <label asp-for="Product.ProductCode" class="control-label"></label>
                <input asp-for="Product.ProductCode" class="form-control" />
                <span asp-validation-for="Product.ProductCode" class="text-danger"></span>
            </div>
            <div class="form-group col-md-6">
                <label asp-for="Product.Name" class="control-label"></label>
                <input asp-for="Product.Name" class="form-control" />
                <span asp-validation-for="Product.Name" class="text-danger"></span>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label asp-for="Product.Description" class="control-label"></label>
                <textarea asp-for="Product.Description" class="form-control" style="height: 44px;width: 320px;"></textarea>
                <span asp-validation-for="Product.Description" class="text-danger"></span>
            </div>
            <div class="form-group" style="margin-left:  -2.9rem;">
                <label asp-for="Product.CategoryId" class="control-label">Category</label>
                <select asp-for="Product.CategoryId" class="form-control" asp-items="Model.CategoryList"></select>
                <span asp-validation-for="Product.CategoryId" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group">
            <label asp-for="Product.ImageUrl" class="control-label">Picture</label>
            <img id="productImage" src="" alt="Product Image" style="max-width: 400px; display: none;" />
        </div>

        <div class="form-group">
            <label asp-for="ImageFile" class="control-label">Update picture</label>
            <input type="file" asp-for="ImageFile" class="form-control" />
        </div>

        <button type="submit" class="btn btn-primary">Save</button>
    </form>

    <a asp-page="./Overview">Back to List</a>
</div>


@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var imageId = @Model.Product.ProductId;

            fetch(`?handler=GetProductImage&id=${imageId}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => response.json()) 
                .then(data => {
                    if (data && data.base64Image) {
                        const imgElement = document.getElementById('productImage');
                        imgElement.src = `data:image/jpeg;base64,${data.base64Image}`;
                        imgElement.style.display = 'block';
                    }
                    else {
                        console.log(data);
                    }
                })
                .catch(error => {
                    console.error('Error fetching the image:', error);
                });
        });
    </script>
}
